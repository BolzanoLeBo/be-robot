<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.9" />
<title>1. Create your robot model</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>1. Create your robot model</h1>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_objectives">Objectives</h2>
<div class="sectionbody">
<div class="paragraph"><p>The objectives of the first tutorial is to understand the basic principles of the robot-model software Pinocchio: How a model is stored? How the model can be displayed in 3D using the software Gepetto-viewer? How the model computation routines can be called?</p></div>
<div class="paragraph"><p>Mostly, we focus here on forward geometry.</p></div>
<div class="paragraph"><p>At the end of the tutorial, you should have a kinematic model of the robot of your dreams, with simple 3D geometry displayed in Gepetto-viewer. All that should be stored in a simple class Robot that would be used throughout the following tutorials.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_1_0_tips">Tutorial 1.0. Tips</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ubuntu">Ubuntu</h3>
<div class="paragraph"><p>The tutorial environment would typically be a Ubuntu 12.04 computer with Pinocchio and Gepetto-viewer installed. VirtualBox images with both software already installed are available on demand.</p></div>
<div class="paragraph"><p>Once your Ubuntu is started, you can start a new terminal by typing CTRL-ALT-T. The shortcut will typically launch a gnome-terminal process. Inside the gnome-terminal window, you can open new terminals (in new tabulations) by typing CTRL-SHIFT-T, and navigate between tabulations with CTRL-PgUp and CTRL-PgDn.</p></div>
</div>
<div class="sect2">
<h3 id="_python">Python</h3>
<div class="paragraph"><p>All the tutorials will use the Python language.</p></div>
<div class="paragraph"><p>You can open a python terminal in your own shell. Simply type :</p></div>
<div class="literalblock">
<div class="content">
<pre><code>student@pinocchio1204x32vbox:~$ ipython
&gt;&gt;&gt;</code></pre>
</div></div>
<div class="paragraph"><p>Afterwards you will just have to type your commands in this newly opened terminal.</p></div>
<div class="paragraph"><p>To close the python terminal, just type CTRL-D (possibly typing CTRL-C first to interrupt any on-going execution).</p></div>
<div class="paragraph"><p>The code that you enter inside the interactive shell is lost. It must only be used for debugging and simple experiments. Rather store the code that you produce inside a Python script file. For example, you can place the script files in /home/student/src/student. Name it with the ID of the tutorial in prefix, and .py in suffix. You can use any editor you want for editing the python script. The most basic one is gedit.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>student@pinocchio1204x32vbox:~$ cd ~/src/student
student@pinocchio1204x32vbox:~/src/student$ gedit tuto1_q1.py</code></pre>
</div></div>
<div class="paragraph"><p>You can then launch this script before entering in interactive mode:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>student@pinocchio1204x32vbox:~/src/student$ ipython -i tuto1_q1.py
&gt;&gt;&gt;</code></pre>
</div></div>
<div class="paragraph"><p>You can also run it without entering the interactive mode
(ie. without starting a new python terminal). In your shell, just type:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>student@pinocchio1204x32vbox:~/src/student$ ipython tuto1_q1.py
student@pinocchio1204x32vbox:~/src/student$</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_numpy">Numpy</h3>
<div class="paragraph"><p>NumPy (Numerics for Python) is the standard linear algebra library for Python. It contains two main classes: array and matrices, matrices being 2-dimension arrays with a dedicated algebra. Numpy is later extended with scientific algorithms (SciPy) and graphical plots (MatPlotLib), that we will use as well in following tutorials.</p></div>
<div class="paragraph"><p>In the following, we will use numpy Matrix class to represent matrices and vectors.
In Numpy, vectors simply are matrices with one column. See the following example.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># Examples of matrix-vector operations with Numpy.</span></span>
<span style="font-weight: bold"><span style="color: #000080">import</span></span> numpy as np
A <span style="color: #990000">=</span> np<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">matrix</span></span><span style="color: #990000">([</span> <span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">,</span><span style="color: #993399">2</span><span style="color: #990000">,</span><span style="color: #993399">3</span><span style="color: #990000">,</span><span style="color: #993399">4</span><span style="color: #990000">],[</span><span style="color: #993399">5</span><span style="color: #990000">,</span><span style="color: #993399">6</span><span style="color: #990000">,</span><span style="color: #993399">7</span><span style="color: #990000">,</span><span style="color: #993399">8</span><span style="color: #990000">]])</span> <span style="font-style: italic"><span style="color: #9A1900"># Define a 2x4 matrix</span></span>
b <span style="color: #990000">=</span> np<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">zeros</span></span><span style="color: #990000">([</span><span style="color: #993399">4</span><span style="color: #990000">,</span><span style="color: #993399">1</span><span style="color: #990000">])</span>   <span style="font-style: italic"><span style="color: #9A1900"># Define a 4 vector (ie a 4x1 matrix) initialized with 0.</span></span>
c <span style="color: #990000">=</span> A<span style="color: #990000">*</span>b               <span style="font-style: italic"><span style="color: #9A1900"># Obtain c by multiplying A by b.</span></span></tt></pre></div></div>
<div class="paragraph"><p>A bunch of useful functions are packaged in the utils of pinocchio.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># Example of matrix-vector shortcut functions with Numpy inside Pinocchio.</span></span>
<span style="font-weight: bold"><span style="color: #000080">from</span></span> pinocchio<span style="color: #990000">.</span>utils <span style="font-weight: bold"><span style="color: #000080">import</span></span> <span style="color: #990000">*</span>
<span style="font-weight: bold"><span style="color: #000000">eye</span></span><span style="color: #990000">(</span><span style="color: #993399">6</span><span style="color: #990000">)</span>                    <span style="font-style: italic"><span style="color: #9A1900"># Return a 6x6 identity matrix</span></span>
<span style="font-weight: bold"><span style="color: #000000">zero</span></span><span style="color: #990000">(</span><span style="color: #993399">6</span><span style="color: #990000">)</span>                   <span style="font-style: italic"><span style="color: #9A1900"># Return a zero 6x1 vector</span></span>
<span style="font-weight: bold"><span style="color: #000000">zero</span></span><span style="color: #990000">([</span><span style="color: #993399">6</span><span style="color: #990000">,</span><span style="color: #993399">4</span><span style="color: #990000">])</span>               <span style="font-style: italic"><span style="color: #9A1900"># Return a zero 6x4 matrix</span></span>
<span style="font-weight: bold"><span style="color: #000000">rand</span></span><span style="color: #990000">(</span><span style="color: #993399">6</span><span style="color: #990000">)</span>                   <span style="font-style: italic"><span style="color: #9A1900"># Random 6x1 vector</span></span>
<span style="font-weight: bold"><span style="color: #000000">isapprox</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">zero</span></span><span style="color: #990000">(</span><span style="color: #993399">6</span><span style="color: #990000">),</span><span style="font-weight: bold"><span style="color: #000000">rand</span></span><span style="color: #990000">(</span><span style="color: #993399">6</span><span style="color: #990000">))</span> <span style="font-style: italic"><span style="color: #9A1900"># Test epsilon equality</span></span>
<span style="font-weight: bold"><span style="color: #000000">mprint</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">rand</span></span><span style="color: #990000">([</span><span style="color: #993399">6</span><span style="color: #990000">,</span><span style="color: #993399">6</span><span style="color: #990000">]))</span>       <span style="font-style: italic"><span style="color: #9A1900"># Matlab-style print</span></span>
<span style="font-weight: bold"><span style="color: #000000">skew</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">rand</span></span><span style="color: #990000">(</span><span style="color: #993399">3</span><span style="color: #990000">))</span>             <span style="font-style: italic"><span style="color: #9A1900"># Skew "cross-product" 3x3 matrix from a 3x1 vector</span></span>
<span style="font-weight: bold"><span style="color: #000000">cross</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">rand</span></span><span style="color: #990000">(</span><span style="color: #993399">3</span><span style="color: #990000">),</span><span style="font-weight: bold"><span style="color: #000000">rand</span></span><span style="color: #990000">(</span><span style="color: #993399">3</span><span style="color: #990000">))</span>    <span style="font-style: italic"><span style="color: #9A1900"># Cross product of R^3</span></span>
<span style="font-weight: bold"><span style="color: #000000">rotate</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'x'</span><span style="color: #990000">,</span><span style="color: #993399">0.4</span><span style="color: #990000">)</span>           <span style="font-style: italic"><span style="color: #9A1900"># Build a rotation matrix of 0.4rad around X.</span></span></tt></pre></div></div>
<div class="paragraph"><p>A pretty matlab-style print of matrices is implemented by the function mprint.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">mprint</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">eye</span></span><span style="color: #990000">(</span><span style="color: #993399">3</span><span style="color: #990000">))</span></tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_pinocchio">Pinocchio</h3>
<div class="paragraph"><p>Pinocchio typically requires the following imports. It is advice to start any of your script by the following few lines.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># Typical header of a Python script using Pinocchio</span></span>
<span style="font-weight: bold"><span style="color: #000080">from</span></span> pinocchio<span style="color: #990000">.</span>utils <span style="font-weight: bold"><span style="color: #000080">import</span></span> <span style="color: #990000">*</span>
<span style="font-weight: bold"><span style="color: #000080">from</span></span> pinocchio<span style="color: #990000">.</span>explog <span style="font-weight: bold"><span style="color: #000080">import</span></span> exp<span style="color: #990000">,</span>log
<span style="font-weight: bold"><span style="color: #000080">from</span></span> numpy<span style="color: #990000">.</span>linalg <span style="font-weight: bold"><span style="color: #000080">import</span></span> pinv<span style="color: #990000">,</span>norm
<span style="font-weight: bold"><span style="color: #000080">import</span></span> pinocchio as se3
<span style="font-weight: bold"><span style="color: #000080">import</span></span> gepetto<span style="color: #990000">.</span>corbaserver</tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_se3_objects">SE3 objects</h3>
<div class="paragraph"><p>Pinocchio is implementing dedicated mathematics classes to represent SE3 objects. For this tutorial, we will only need rigid displacement SE3. The class is implemented in Pinocchio under the name SE3. It uses the representation by rotation matrix 3x3 and translation vector 3x1. You can access and modify the translation and rotation. The neutral element of the group is SE3.Identity(). A random displacement can be generated using SE3.Random(). Elements of SE3 can be multiplied together. Inverse in SE3 are obtained by the method SE3.inverse. 3D vector can be moved also by multiplying with SE3 objects.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># Examples of SE3 operations in Pinocchio.</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">print</span></span> se3<span style="color: #990000">.</span>SE3
I44 <span style="color: #990000">=</span> se3<span style="color: #990000">.</span>SE3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Identity</span></span><span style="color: #990000">()</span>
Mrand <span style="color: #990000">=</span> se3<span style="color: #990000">.</span>SE3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Random</span></span><span style="color: #990000">()</span>
<span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span>Mrand<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span>Mrand<span style="color: #990000">.</span>rotation<span style="color: #990000">,</span>Mrand<span style="color: #990000">.</span>translation<span style="color: #990000">)</span>
Mrand<span style="color: #990000">.</span>translation <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">zero</span></span><span style="color: #990000">(</span><span style="color: #993399">3</span><span style="color: #990000">)</span>
Mrand<span style="color: #990000">.</span>rotation <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">eye</span></span><span style="color: #990000">(</span><span style="color: #993399">3</span><span style="color: #990000">)</span>
oM1<span style="color: #990000">,</span>oM2 <span style="color: #990000">=</span> se3<span style="color: #990000">.</span>SE3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Random</span></span><span style="color: #990000">(),</span>se3<span style="color: #990000">.</span>SE3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Random</span></span><span style="color: #990000">()</span>
_2Mo <span style="color: #990000">=</span> oM2<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">inverse</span></span><span style="color: #990000">()</span>
_2M1 <span style="color: #990000">=</span> _2Mo<span style="color: #990000">*</span>oM1
_1p <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">rand</span></span><span style="color: #990000">(</span><span style="color: #993399">3</span><span style="color: #990000">)</span>
op <span style="color: #990000">=</span> oM1<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">act</span></span><span style="color: #990000">(</span>_1p<span style="color: #990000">)</span></tt></pre></div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_1_1_display_cubes_cylinder_and_spheres">Tutorial 1.1. Display cubes, cylinder and spheres</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_create_the_display">Create the display</h3>
<div class="paragraph"><p>For display, we will use Gepetto-viewer, a simple 3D renderer build on top of OpenSceneGraph (try to google this name). Gepetto-viewer is a standalone Corba server. It means that the display will run permanently as an independent Linux process, without having to be restarted each time your restart your Python script. Your scripts will communicate using the middleware Corba with the display (do not be afraid, for you it will be transparent).</p></div>
<div class="paragraph"><p>In your script, you need to import the Gepetto-viewer client library (named <em>hpp-gui</em>), connect with the server, possibly create 3D objects and then move these objects while your robot is moving.</p></div>
<div class="paragraph"><p>First, you need to start the server in a first terminal:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>student@pinocchio1204x32vbox:~$ hpp-gui</code></pre>
</div></div>
<div class="paragraph"><p>Your own Python scripts can be started from a second terminal.
The following class do all the client work for you. Just copy-paste it.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># Example of a class Display that connect to Gepetto-viewer and implement a</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># 'place' method to set the position/rotation of a 3D visual object in a scene.</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">Display</span></span><span style="color: #990000">():</span>
<span style="font-style: italic"><span style="color: #9A1900">    '''</span></span>
<span style="font-style: italic"><span style="color: #9A1900">    Class Display: Example of a class implementing a client for the Gepetto-viewer server. The main</span></span>
<span style="font-style: italic"><span style="color: #9A1900">    method of the class is 'place', that sets the position/rotation of a 3D visual object in a scene.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">    '''</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span>windowName <span style="color: #990000">=</span> <span style="color: #FF0000">"pinocchio"</span> <span style="color: #990000">):</span>
<span style="font-style: italic"><span style="color: #9A1900">        '''</span></span>
<span style="font-style: italic"><span style="color: #9A1900">        This function connect with the Gepetto-viewer server and open a window with the given name.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">        If the window already exists, it is kept in the current state. Otherwise, the newly-created</span></span>
<span style="font-style: italic"><span style="color: #9A1900">        window is set up with a scene named 'world'.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">        '''</span></span>

        <span style="font-style: italic"><span style="color: #9A1900"># Create the client and connect it with the display server.</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">try</span></span><span style="color: #990000">:</span>
            self<span style="color: #990000">.</span>viewer<span style="color: #990000">=</span>gepetto<span style="color: #990000">.</span>corbaserver<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Client</span></span><span style="color: #990000">()</span>
        <span style="font-weight: bold"><span style="color: #0000FF">except</span></span><span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #FF0000">"Error while starting the viewer client. "</span>
            <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #FF0000">"Check whether Gepetto-viewer is properly started"</span>

        <span style="font-style: italic"><span style="color: #9A1900"># Open a window for displaying your model.</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">try</span></span><span style="color: #990000">:</span>
            <span style="font-style: italic"><span style="color: #9A1900"># If the window already exists, do not do anything.</span></span>
            windowID <span style="color: #990000">=</span> self<span style="color: #990000">.</span>viewer<span style="color: #990000">.</span>gui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getWindowID</span></span> <span style="color: #990000">(</span>windowName<span style="color: #990000">)</span>
            <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #FF0000">"Warning: window '"</span><span style="color: #990000">+</span>windowName<span style="color: #990000">+</span><span style="color: #FF0000">"' already created."</span>
            <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #FF0000">"The previously created objects will not be destroyed and do not have to be created again."</span>
        <span style="font-weight: bold"><span style="color: #0000FF">except</span></span><span style="color: #990000">:</span>
            <span style="font-style: italic"><span style="color: #9A1900"># Otherwise, create the empty window.</span></span>
            windowID <span style="color: #990000">=</span> self<span style="color: #990000">.</span>viewer<span style="color: #990000">.</span>gui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">createWindow</span></span> <span style="color: #990000">(</span>windowName<span style="color: #990000">)</span>
            <span style="font-style: italic"><span style="color: #9A1900"># Start a new "scene" in this window, named "world", with just a floor.</span></span>
            self<span style="color: #990000">.</span>viewer<span style="color: #990000">.</span>gui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">createSceneWithFloor</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"world"</span><span style="color: #990000">)</span>
            self<span style="color: #990000">.</span>viewer<span style="color: #990000">.</span>gui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addSceneToWindow</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"world"</span><span style="color: #990000">,</span>windowID<span style="color: #990000">)</span>

        <span style="font-style: italic"><span style="color: #9A1900"># Finally, refresh the layout to obtain your first rendering.</span></span>
        self<span style="color: #990000">.</span>viewer<span style="color: #990000">.</span>gui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">refresh</span></span><span style="color: #990000">()</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">nofloor</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
<span style="font-style: italic"><span style="color: #9A1900">        '''</span></span>
<span style="font-style: italic"><span style="color: #9A1900">        This function will hide the floor.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">        '''</span></span>
        self<span style="color: #990000">.</span>viewer<span style="color: #990000">.</span>gui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">setVisibility</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'world/floor'</span><span style="color: #990000">,</span><span style="color: #FF0000">"OFF"</span><span style="color: #990000">)</span>
        self<span style="color: #990000">.</span>viewer<span style="color: #990000">.</span>gui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">refresh</span></span><span style="color: #990000">()</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">place</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span>objName<span style="color: #990000">,</span>M<span style="color: #990000">,</span>refresh<span style="color: #990000">=</span>True<span style="color: #990000">):</span>
<span style="font-style: italic"><span style="color: #9A1900">        '''</span></span>
<span style="font-style: italic"><span style="color: #9A1900">        This function places (ie changes both translation and rotation) of the object</span></span>
<span style="font-style: italic"><span style="color: #9A1900">        names "objName" in place given by the SE3 object "M". By default, immediately refresh</span></span>
<span style="font-style: italic"><span style="color: #9A1900">        the layout. If multiple objects have to be placed at the same time, do the refresh</span></span>
<span style="font-style: italic"><span style="color: #9A1900">        only at the end of the list.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">        '''</span></span>
        self<span style="color: #990000">.</span>viewer<span style="color: #990000">.</span>gui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">applyConfiguration</span></span><span style="color: #990000">(</span>objName<span style="color: #990000">,</span>
                                           <span style="font-weight: bold"><span style="color: #000000">XYZQUATToViewerConfiguration</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">se3ToXYZQUAT</span></span><span style="color: #990000">(</span>M<span style="color: #990000">))</span> <span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> refresh<span style="color: #990000">:</span> self<span style="color: #990000">.</span>viewer<span style="color: #990000">.</span>gui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">refresh</span></span><span style="color: #990000">()</span></tt></pre></div></div>
<div class="paragraph"><p>You can create an instance of display with no argument.
The Display class will likely be used in all your scripts. You can generalize the work by put the class alone in a Python file named display.py. Then import it in any of your script by doing:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># Example of creation of an object of class Display (implemented in the previous example, inside</span></span>
<span style="font-style: italic"><span style="color: #9A1900">#  a file 'display.py'). Do not forget to start Gepetto-viewer server in another terminal before</span></span>
<span style="font-style: italic"><span style="color: #9A1900">#  creating the client.</span></span>
<span style="font-weight: bold"><span style="color: #000080">from</span></span> display <span style="font-weight: bold"><span style="color: #000080">import</span></span> Display
display <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">Display</span></span><span style="color: #990000">()</span></tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_create_simple_objects">Create simple objects</h3>
<div class="paragraph"><p>Any object of Gepetto viewer is referenced by a name inside a scene. For
example, a box named "box" in scene "world" would be referenced by the path
"world/box".</p></div>
<div class="paragraph"><p>Put all you objects in the general scene "world". You can use any names.</p></div>
<div class="paragraph"><p>A box of dimension 2x2x2 can be created using the function</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># Example of use of the class Display to create a box visual object.</span></span>
boxid   <span style="color: #990000">=</span> <span style="color: #993399">147</span>
name    <span style="color: #990000">=</span> <span style="color: #FF0000">'box'</span> <span style="color: #990000">+</span> <span style="font-weight: bold"><span style="color: #000000">str</span></span><span style="color: #990000">(</span>boxid<span style="color: #990000">)</span>
<span style="color: #990000">[</span>w<span style="color: #990000">,</span>h<span style="color: #990000">,</span>d<span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #990000">[</span><span style="color: #993399">1.0</span><span style="color: #990000">,</span><span style="color: #993399">1.0</span><span style="color: #990000">,</span><span style="color: #993399">1.0</span><span style="color: #990000">]</span>
color   <span style="color: #990000">=</span> <span style="color: #990000">[</span>red<span style="color: #990000">,</span>green<span style="color: #990000">,</span>blue<span style="color: #990000">,</span>transparency<span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">,</span><span style="color: #993399">1</span><span style="color: #990000">,</span><span style="color: #993399">0.78</span><span style="color: #990000">,</span><span style="color: #993399">1.0</span><span style="color: #990000">]</span>
display<span style="color: #990000">.</span>viewer<span style="color: #990000">.</span>gui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addBox</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'world/'</span><span style="color: #990000">+</span>name<span style="color: #990000">,</span> w<span style="color: #990000">,</span>h<span style="color: #990000">,</span>d<span style="color: #990000">,</span>color<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>A sphere of dimension 1x1x1 can be create using:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># Example of use of the class Display to create a sphere visual object.</span></span>
display<span style="color: #990000">.</span>viewer<span style="color: #990000">.</span>gui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addSphere</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'world/sphere'</span><span style="color: #990000">,</span> <span style="color: #993399">1.0</span><span style="color: #990000">,</span>color<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>A cylinder of dimension 1x1x1 can be created using:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># Example of use of the class Display to create a cylinder visual object.</span></span>
radius <span style="color: #990000">=</span> <span style="color: #993399">1.0</span>
height <span style="color: #990000">=</span> <span style="color: #993399">1.0</span>
display<span style="color: #990000">.</span>viewer<span style="color: #990000">.</span>gui<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addCylinder</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'world/cylinder'</span><span style="color: #990000">,</span> radius<span style="color: #990000">,</span>height<span style="color: #990000">,</span>color<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Other 3D primitives can be created as well. Checkout the gepetto-viewer IDL <code>graphical-interface.idl</code> in the directory where pinocchio has been installed, e.g.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>student@pinocchio1204x32vbox:~$ less $ROBOTPKG_BASE/share/idl/gepetto/corbaserver/graphical-interface.idl</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_moving_objects">Moving objects</h3>
<div class="paragraph"><p>Place an object by simply mentioning its name and the placement you want.
Gepetto-Viewer expects a XYZ-roll-pitch-yaw representation of the SE3 placement. The translation is performed by the method "place" of your class "Display".
After placing an object, the layout must be explicitly refreshed. This is to reduce the display load when flushing several objects at the same time. Typically, during robot movements, you would only ask one refresh per control cycle. The method "Display.place" refreshes the layout by default.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># Example of use of the class display to place the previously-create object at random SE3 placements.</span></span>
display<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">place</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"world/box147"</span><span style="color: #990000">,</span>se3<span style="color: #990000">.</span>SE3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Random</span></span><span style="color: #990000">(),</span>False<span style="color: #990000">)</span>
display<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">place</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"world/sphere"</span><span style="color: #990000">,</span>se3<span style="color: #990000">.</span>SE3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Random</span></span><span style="color: #990000">(),</span>False<span style="color: #990000">)</span>
display<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">place</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"world/cylinder"</span><span style="color: #990000">,</span>se3<span style="color: #990000">.</span>SE3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Random</span></span><span style="color: #990000">())</span></tt></pre></div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_1_3_creating_the_robot_model">Tutorial 1.3 Creating the robot model</h2>
<div class="sectionbody">
<div class="paragraph"><p>In this section, instructions are given to build a robot model by adding joints and bodies to
an empty kinematic tree. An example of how to build a simple robot arm is given in <a href="robot_arm.html">this python code</a>. You can use it to build a more complex robot.</p></div>
<div class="sect2">
<h3 id="_model_and_data">Model and Data</h3>
<div class="paragraph"><p>Pinocchio models are separated in two classes. The class "Model" gathers all the constant elements. The class "Data" is generated from an object "Model". It gathers all the swap memory that is used by the algorithms of Pinocchio to perform the computations. Typically, an algorithm will take a Model and a Data, let Model unchanged and put the results in Data.</p></div>
<div class="paragraph"><p>The two classes are se3.Model and se3.Data.</p></div>
</div>
<div class="sect2">
<h3 id="_creating_a_model">Creating a Model</h3>
<div class="paragraph"><p>An empty model is created using the method se3.Model.BuildEmptyModel().</p></div>
<div class="paragraph"><p>When created, a model contains a single body (representing the universe, with a trivial mass and inertia) and no joint.</p></div>
<div class="paragraph"><p>Joints are added in a recursive fashion, using the methods Model.addJoint:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># Example of creation of a simple robot model with one single revolute joint rotating around axis X.</span></span>
model <span style="color: #990000">=</span> se3<span style="color: #990000">.</span>Model<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">BuildEmptyModel</span></span><span style="color: #990000">()</span>
jointName          <span style="color: #990000">=</span> <span style="color: #FF0000">"first_joint"</span>                       <span style="font-style: italic"><span style="color: #9A1900"># Name of joint.</span></span>
jointPlacement     <span style="color: #990000">=</span> se3<span style="color: #990000">.</span>SE3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Random</span></span><span style="color: #990000">()</span>                    <span style="font-style: italic"><span style="color: #9A1900"># SE3 placement of the joint wrt chain init.</span></span>
parent             <span style="color: #990000">=</span> <span style="color: #993399">0</span>                                   <span style="font-style: italic"><span style="color: #9A1900"># Index of the parent (0 is the universe).</span></span>
jointModel         <span style="color: #990000">=</span> se3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">JointModelRX</span></span><span style="color: #990000">()</span>                  <span style="font-style: italic"><span style="color: #9A1900"># Type of the joint to be created.</span></span>
jointId <span style="color: #990000">=</span> model<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addJoint</span></span><span style="color: #990000">(</span>parent<span style="color: #990000">,</span>jointModel<span style="color: #990000">,</span>jointPlacement<span style="color: #990000">,</span>jointName<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #0000FF">print</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'Model dimensions: {:d}, {:d}, {:d}'</span><span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">format</span></span><span style="color: #990000">(</span>model<span style="color: #990000">.</span>nq<span style="color: #990000">,</span>model<span style="color: #990000">.</span>nv<span style="color: #990000">,</span>model<span style="color: #990000">.</span>nbodies<span style="color: #990000">))</span></tt></pre></div></div>
<div class="paragraph"><p>Bodies are then attached to joints, to specify their mass, center-of-mass position and inertia, by using the method Model.appendBodyToJoint:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># Example of</span></span>
bodyInertia        <span style="color: #990000">=</span> se3<span style="color: #990000">.</span>Inertia<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Random</span></span><span style="color: #990000">()</span>                <span style="font-style: italic"><span style="color: #9A1900"># Body mass/center of mass/inertia</span></span>
model<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">appendBodyToJoint</span></span><span style="color: #990000">(</span>jointId<span style="color: #990000">,</span> bodyInertia<span style="color: #990000">,</span> body_placement <span style="color: #990000">=</span> se3<span style="color: #990000">.</span>SE3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">Identity</span></span><span style="color: #990000">())</span> <span style="font-style: italic"><span style="color: #9A1900"># The last</span></span>
                                                         <span style="font-style: italic"><span style="color: #9A1900"># argument is likely to always be Identity.</span></span></tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_joint_models">Joint Models</h3>
<div class="paragraph"><p>In the previous code, the joint is a revolute that rotates around the X axis. Y and Z axis are also available.</p></div>
<div class="paragraph"><p>Other joints are available in Pinocchio. The most classical to use are the revolutes and the free-flyers (se3.JointModelFreeFlyer). Free flyer is typically the first joint for mobile robots such as humanoids. More to come in the next tutorial about free flyer joints.</p></div>
</div>
<div class="sect2">
<h3 id="_creating_the_data">Creating the data</h3>
<div class="paragraph"><p>After all the joint have been added, a data object can be generated using the method Model.createData.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># Example of how to create a 'Data' object from a 'Model' object.</span></span>
data <span style="color: #990000">=</span> model<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">createData</span></span><span style="color: #990000">()</span></tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_associating_visual_object_to_bodies">Associating visual object to bodies</h3>
<div class="paragraph"><p>For any body, you can create one or several visual objects and "attached" them to arbitrary SE3 placements. Fro each body of your model, you should define a list of pairs (3D name, 3D placement). Very likely, each body should have zero or one element in its corresponding list. You can store all these lists in a list named "visuals", containing "model.nbody" elements. The choice of the data structure to store the visuals is yours. Using this structure, you should be able to simply access for each visual the id of the body it is attached to, the placement of the visual in the body frame and the name of the visual feature in viewer.</p></div>
<div class="paragraph"><p>The visual elements of the scene (i.e. static elements that are not attached to the robot) can be attached to the "universe" body 0 of the model, in the first element of the "visuals" list.</p></div>
</div>
<div class="sect2">
<h3 id="_the_robot_class">The robot class</h3>
<div class="paragraph"><p>The objective of this tutorial is to gather all the elements explained above to create a single Robot class. The class must contains the 4 following elements:
* A model object
* A data object
* A display object
* A list of visual object</p></div>
<div class="paragraph"><p>In a first time, build a simple serial-chain manipulator with 6 degrees of freedom and a fixed based by taking inspiration of the <a href="robot_arm.html">provided example</a>. Back-up the serial version and then increase it to obtain a complete version of your robot.</p></div>
<div class="paragraph"><p>Your final robot should be a legged robot, with at least two limbs designed for walking (i.e. with full controllability of the end-effector position and orientation), and with the first joint being a "free-flyer". It is recommended to target a humanoid general organization, although the next of the tutorials should also work for tripeds, or other "centauroid" (i.e. 4+ legs and 2+ arms)robots.</p></div>
<div class="paragraph"><p><strong>Question 1:</strong> Create a class Robot as specified previously. Store the results in a dedicated python file "robot.py".</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_1_4_displaying_the_model">Tutorial 1.4. Displaying the model</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_computing_the_robot_geometry">Computing the robot geometry</h3>
<div class="paragraph"><p>The algorithms of Pinocchio are implemented as static functions, that take in two first arguments a robot model and the corresponding data, with typically additional arguments specifying the robot configuration, velocity, etc.</p></div>
<div class="paragraph"><p>The function "se3.geometry" computes the placement of all the robot bodies with respect to the world reference. It takes as input the robot configuration, i.e.  a vector "q" of dimension robot.nq. The function has no direct output. The results are stored in the table data.oMi. This table contains model.nbody elements. Each element is a SE3 object specifying the placement of the corresponding body.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># Example of use of the function 'geometry' in Pinocchio.</span></span>
q <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">rand</span></span><span style="color: #990000">(</span>model<span style="color: #990000">.</span>nq<span style="color: #990000">)</span>
se3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">forwardKinematics</span></span><span style="color: #990000">(</span>model<span style="color: #990000">,</span>data<span style="color: #990000">,</span>q<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #0000FF">for</span></span> i <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> <span style="font-weight: bold"><span style="color: #000000">range</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span>model<span style="color: #990000">.</span>nbody<span style="color: #990000">):</span>
    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> model<span style="color: #990000">.</span>names<span style="color: #990000">[</span>i<span style="color: #990000">],</span><span style="color: #FF0000">": "</span><span style="color: #990000">,</span>data<span style="color: #990000">.</span>oMi<span style="color: #990000">[</span>i<span style="color: #990000">]</span></tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_displaying_the_model">Displaying the model</h3>
<div class="paragraph"><p>Consider body "ibody" to which one visual "ivisual" is attached. The placement of the body in the world is data.oMi[ibody]. The name of the visual is visuals[ibody][ivisual][0]. The placement of the visual in the body frame is visuals[ibody][ivisual][1]. The placement of the visual in the world is obtained by multiplying both elements.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># Example of computation of the placement of the visual object.</span></span>
ibody <span style="color: #990000">=</span> <span style="color: #993399">1</span>
ivisual <span style="color: #990000">=</span> <span style="color: #993399">0</span>
oMbody <span style="color: #990000">=</span> data<span style="color: #990000">.</span>oMi<span style="color: #990000">[</span>ibody<span style="color: #990000">]</span>
visualName <span style="color: #990000">=</span>  visuals<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getVisualName</span></span><span style="color: #990000">(</span>ivusal<span style="color: #990000">)</span>
bodyMvisual <span style="color: #990000">=</span> visuals<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getVisualPlacemenT</span></span><span style="color: #990000">(</span>ivusal<span style="color: #990000">)</span>
oMvisual <span style="color: #990000">=</span> oMbody<span style="color: #990000">*</span>bodyMvisual
<span style="font-weight: bold"><span style="color: #0000FF">print</span></span> visualName<span style="color: #990000">,</span><span style="color: #FF0000">": "</span><span style="color: #990000">,</span>oMvisual</tt></pre></div></div>
<div class="paragraph"><p><strong>Question 2:</strong> Loops across all the visuals to display them on the Gepetto-Viewer layout. Remember to only refresh the layout at the end of the display loop. Place this algorithm in a Robot.display method, that takes the robot configuration as a vector "q", computes the geometry and display the visuals at the correct places.</p></div>
</div>
<div class="sect2">
<h3 id="_move_your_robot">Move your robot</h3>
<div class="paragraph"><p><strong>Question 3:</strong> From an initial position q0, chose an arbitrary velocity v and integrate it with small (1e-3) timestep, while displaying the robot configuration at every integration step.</p></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2017-01-05 10:43:12 CET
</div>
</div>
</body>
</html>
