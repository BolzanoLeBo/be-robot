<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.9" />
<title>3. Dynamic walk</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>3. Dynamic walk</h1>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_objective">Objective</h2>
<div class="sectionbody">
<div class="paragraph"><p>The objective of this part is to generate a dynamically balanced walk motion
for the humanoid robot as time-varying reference tasks for each foot and for the
center of mass of the robot.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_3_0_prerequesites">Tutorial 3.0: prerequesites</h2>
<div class="sectionbody">
<div class="paragraph"><p>From the two previous tutorials, you should have the two following implementations available:</p></div>
<div class="ulist"><ul>
<li>
<p>
A humanoid robot models, with at least two legs.
</p>
</li>
<li>
<p>
An inverse geometry solver based on BFGS.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Yet, the inverse geometry only solves the motion of the robot for a constant task, like reaching a specific position of the hand, or a constant position of the center of mass.</p></div>
<div class="paragraph"><p>It is possible to modify the BFGS call to perform an inverse kinematics by (i) limiting the number of iteration of BFGS to a small value e.g 10 iterations maximum, (ii) initializing the non-linear search from the previous configuration of the robot, and  (iii) turning off the default verbose output of BFGS. For example, the robot can track a target moving vertically using the following example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>cost<span style="color: #990000">.</span>Mdes <span style="color: #990000">=</span> se3<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">SE3</span></span><span style="color: #990000">(</span> <span style="font-weight: bold"><span style="color: #000000">eye</span></span><span style="color: #990000">(</span><span style="color: #993399">3</span><span style="color: #990000">),</span>np<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">matrix</span></span><span style="color: #990000">([</span><span style="color: #993399">0.2</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">,</span><span style="color: #993399">0.1</span><span style="color: #990000">+</span>t<span style="color: #990000">/</span><span style="color: #993399">100</span><span style="color: #990000">.])</span> <span style="color: #990000">)</span> <span style="font-style: italic"><span style="color: #9A1900"># Reference target at time 0.</span></span>
q <span style="color: #990000">=</span> np<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">copy</span></span><span style="color: #990000">(</span>robot<span style="color: #990000">.</span>q0<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #0000FF">for</span></span> t <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> <span style="font-weight: bold"><span style="color: #000000">range</span></span><span style="color: #990000">(</span><span style="color: #993399">100</span><span style="color: #990000">):</span>
    cost<span style="color: #990000">.</span>Mdes<span style="color: #990000">.</span>translation <span style="color: #990000">=</span> np<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">matrix</span></span><span style="color: #990000">([</span><span style="color: #993399">0.2</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">,</span><span style="color: #993399">0.1</span><span style="color: #990000">+</span>t<span style="color: #990000">/</span><span style="color: #993399">100</span><span style="color: #990000">.])</span>
    q <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">a2m</span></span><span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">fmin_bfgs</span></span><span style="color: #990000">(</span>cost<span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">m2a</span></span><span style="color: #990000">(</span>q<span style="color: #990000">),</span>maxiter<span style="color: #990000">=</span><span style="color: #993399">10</span><span style="color: #990000">,</span>disp<span style="color: #990000">=</span>False<span style="color: #990000">))</span>
    robot<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">display</span></span><span style="color: #990000">(</span>q<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>Implement a motion of the right foot of the robot tracking a straight line from the initial position of the robot to a position 10cm forward, while keeping a constant rotation of the foot.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_3_1_defining_input">Tutorial 3.1: defining input</h2>
<div class="sectionbody">
<div class="paragraph"><p>The input of the walk generation algorithm is a sequence of steps with a given
timing. This input will be represented by two sequences as in the examples
below. The class <code>FootSteps</code> (<a href="footsteps.html"><strong>see code link</strong></a>) can be used to
define, store and access to the footstep plan.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># Define 6 steps forward, starting with the left foot and stoping at the same forward position.</span></span>
footsteps <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">FootSteps</span></span><span style="color: #990000">(</span> <span style="color: #990000">[</span><span style="color: #993399">0.0</span><span style="color: #990000">,-</span><span style="color: #993399">0.1</span><span style="color: #990000">]</span> <span style="color: #990000">,</span> <span style="color: #990000">[</span><span style="color: #993399">0.0</span><span style="color: #990000">,</span><span style="color: #993399">0.1</span><span style="color: #990000">]</span> <span style="color: #990000">)</span>
footsteps<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addPhase</span></span><span style="color: #990000">(</span> <span style="color: #990000">.</span><span style="color: #993399">3</span><span style="color: #990000">,</span> <span style="color: #FF0000">'none'</span> <span style="color: #990000">)</span>
footsteps<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addPhase</span></span><span style="color: #990000">(</span> <span style="color: #990000">.</span><span style="color: #993399">7</span><span style="color: #990000">,</span> <span style="color: #FF0000">'left'</span> <span style="color: #990000">,</span> <span style="color: #990000">[</span><span style="color: #993399">0.1</span><span style="color: #990000">,+</span><span style="color: #993399">0.1</span><span style="color: #990000">]</span> <span style="color: #990000">)</span>
footsteps<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addPhase</span></span><span style="color: #990000">(</span> <span style="color: #990000">.</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #FF0000">'none'</span> <span style="color: #990000">)</span>
footsteps<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addPhase</span></span><span style="color: #990000">(</span> <span style="color: #990000">.</span><span style="color: #993399">7</span><span style="color: #990000">,</span> <span style="color: #FF0000">'right'</span><span style="color: #990000">,</span> <span style="color: #990000">[</span><span style="color: #993399">0.2</span><span style="color: #990000">,-</span><span style="color: #993399">0.1</span><span style="color: #990000">]</span> <span style="color: #990000">)</span>
footsteps<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addPhase</span></span><span style="color: #990000">(</span> <span style="color: #990000">.</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #FF0000">'none'</span> <span style="color: #990000">)</span>
footsteps<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addPhase</span></span><span style="color: #990000">(</span> <span style="color: #990000">.</span><span style="color: #993399">7</span><span style="color: #990000">,</span> <span style="color: #FF0000">'left'</span> <span style="color: #990000">,</span> <span style="color: #990000">[</span><span style="color: #993399">0.3</span><span style="color: #990000">,+</span><span style="color: #993399">0.1</span><span style="color: #990000">]</span> <span style="color: #990000">)</span>
footsteps<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addPhase</span></span><span style="color: #990000">(</span> <span style="color: #990000">.</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #FF0000">'none'</span> <span style="color: #990000">)</span>
footsteps<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addPhase</span></span><span style="color: #990000">(</span> <span style="color: #990000">.</span><span style="color: #993399">7</span><span style="color: #990000">,</span> <span style="color: #FF0000">'right'</span><span style="color: #990000">,</span> <span style="color: #990000">[</span><span style="color: #993399">0.4</span><span style="color: #990000">,-</span><span style="color: #993399">0.1</span><span style="color: #990000">]</span> <span style="color: #990000">)</span>
footsteps<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addPhase</span></span><span style="color: #990000">(</span> <span style="color: #990000">.</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #FF0000">'none'</span> <span style="color: #990000">)</span>
footsteps<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addPhase</span></span><span style="color: #990000">(</span> <span style="color: #990000">.</span><span style="color: #993399">7</span><span style="color: #990000">,</span> <span style="color: #FF0000">'left'</span> <span style="color: #990000">,</span> <span style="color: #990000">[</span><span style="color: #993399">0.5</span><span style="color: #990000">,+</span><span style="color: #993399">0.1</span><span style="color: #990000">]</span> <span style="color: #990000">)</span>
footsteps<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addPhase</span></span><span style="color: #990000">(</span> <span style="color: #990000">.</span><span style="color: #993399">1</span><span style="color: #990000">,</span> <span style="color: #FF0000">'none'</span> <span style="color: #990000">)</span>
footsteps<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addPhase</span></span><span style="color: #990000">(</span> <span style="color: #990000">.</span><span style="color: #993399">7</span><span style="color: #990000">,</span> <span style="color: #FF0000">'right'</span><span style="color: #990000">,</span> <span style="color: #990000">[</span><span style="color: #993399">0.5</span><span style="color: #990000">,-</span><span style="color: #993399">0.1</span><span style="color: #990000">]</span> <span style="color: #990000">)</span>
footsteps<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addPhase</span></span><span style="color: #990000">(</span> <span style="color: #990000">.</span><span style="color: #993399">5</span><span style="color: #990000">,</span> <span style="color: #FF0000">'none'</span> <span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>The class stores three functions of time: left, right and flyingFoot.
Each function is piecewise constant. For each function, the user can ask
what is the value of this function at time t.</p></div>
<div class="paragraph"><p>The storage is composed of three lists for left, right and flyingFoot, and a list for time.
The list of times stores the time intervals, i.e. each element of the list is
the start of a time interval. The first element of the list is 0.
The value of the functions left,right,flyingFoot one this time interval is stored at
the same position is their respective list (i.e. value of left on interval
[ time[i],time[i+1] ] is stored in left[i].</p></div>
<div class="paragraph"><p>The 4 lists are set up using function addPhase().
The values of functions left,right,flyingFoot can be accessed through the function
getPhaseType(t), getLeftPosition(t), getRightPosition(t).
PhaseType are <em>left</em> (meaning left foot is flying, right foot is fixed), <em>right</em> (ie the opposite)
or <em>none</em> (meaning no foot is flying, both are fixed on the ground).</p></div>
<div class="paragraph"><p>Additionnally, functions getLeftNextPosition(t),
getRightNextPosition(t) can be used to get the next position of the
flying foot (in that case, additional work is needed to compute the
position of flying foot at time t by interpolating getLeftPosition(t)
and getLeftNextPosition(t).</p></div>
<div class="paragraph"><p>Functions getPhaseStart(t), getPhaseDuration(t) and getPhaseRemaining(t)
can be used to get the starting time, the duration and the remaining time of the
current phase at time t.</p></div>
<div class="paragraph"><p>A phase <em>none</em> defines a double support phase (no foot moving). A phase <em>left</em> (resp. <em>right</em>) defines a simple support phase while indicating the flying foot. The time is a duration. The position is absolute.</p></div>
<div class="paragraph"><p>Each interval corresponds to the following constant support phases:</p></div>
<div class="imageblock latex">
<div class="content">
<img src="3_take_a_walk__1.png" alt="3_take_a_walk__1.png" />
</div>
</div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># Example of use</span></span>
footsteps<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPhaseType</span></span><span style="color: #990000">(.</span><span style="color: #993399">4</span><span style="color: #990000">)</span>         <span style="font-style: italic"><span style="color: #9A1900"># return 'left'</span></span>
footsteps<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getLeftPosition</span></span><span style="color: #990000">(</span><span style="color: #993399">0.4</span><span style="color: #990000">)</span>     <span style="font-style: italic"><span style="color: #9A1900"># return 0,0.1</span></span>
footsteps<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getLeftNextPosition</span></span><span style="color: #990000">(</span><span style="color: #993399">0.4</span><span style="color: #990000">)</span> <span style="font-style: italic"><span style="color: #9A1900"># return 0.1,0.1</span></span>
footsteps<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPhaseStart</span></span><span style="color: #990000">(</span><span style="color: #993399">0.4</span><span style="color: #990000">)</span>       <span style="font-style: italic"><span style="color: #9A1900"># return 0.3</span></span>
footsteps<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPhaseDuration</span></span><span style="color: #990000">(</span><span style="color: #993399">0.4</span><span style="color: #990000">)</span>    <span style="font-style: italic"><span style="color: #9A1900"># return 0.7</span></span>
footsteps<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">getPhaseRemaining</span></span><span style="color: #990000">(</span><span style="color: #993399">0.4</span><span style="color: #990000">)</span>   <span style="font-style: italic"><span style="color: #9A1900"># return 0.6</span></span></tt></pre></div></div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_3_2_computing_reference_zmp">Tutorial 3.2: computing reference ZMP</h2>
<div class="sectionbody">
<div class="paragraph"><p>Implement a python class called <code>ZmpRef</code> that takes as input a
sequence of times and a sequence of steps. Objects of this class behave as
a function of time that returns a 2 dimensional vector:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&gt;&gt;&gt;</span> zmp <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">ZmpRef</span></span> <span style="color: #990000">(</span>footsteps<span style="color: #990000">)</span>
<span style="color: #990000">&gt;&gt;&gt;</span> <span style="font-weight: bold"><span style="color: #000000">zmp</span></span> <span style="color: #990000">(</span><span style="color: #993399">2.5</span><span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #000000">array</span></span><span style="color: #990000">([</span> <span style="color: #993399">0.41</span> <span style="color: #990000">,</span>  <span style="color: #993399">0.096</span><span style="color: #990000">])</span></tt></pre></div></div>
<div class="paragraph"><p>The function should be a piecewise affine function</p></div>
<div class="ulist"><ul>
<li>
<p>
starting in the middle of the ankles of the two first steps,
</p>
</li>
<li>
<p>
finishing in the middle of the two ankles of the two last steps,
</p>
</li>
<li>
<p>
constant under the foot support during single support phases.
</p>
</li>
</ul></div>
<div class="paragraph"><p>You can use the template below.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">ZmpRef</span></span> <span style="color: #990000">(</span>object<span style="color: #990000">):</span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__init__</span></span> <span style="color: #990000">(</span>self<span style="color: #990000">,</span> footsteps<span style="color: #990000">)</span> <span style="color: #990000">:</span>
        self<span style="color: #990000">.</span>footsteps <span style="color: #990000">=</span> footsteps
    <span style="font-style: italic"><span style="color: #9A1900"># Operator ()</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__call__</span></span> <span style="color: #990000">(</span>self<span style="color: #990000">,</span> t<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="font-weight: bold"><span style="color: #000000">array</span></span> <span style="color: #990000">(</span>self<span style="color: #990000">.</span>steps <span style="color: #990000">[</span><span style="color: #993399">0</span><span style="color: #990000">])</span></tt></pre></div></div>
<div class="paragraph"><p>For the inputs provided above, the graph of <code>zmp</code> is given below.</p></div>
<div class="imageblock">
<div class="content">
<img src="images/zmp-ref.png" alt="zmp_ref against time" width="100%" />
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_3_3_reference_trajectory_of_the_center_of_mass">Tutorial 3.3: reference trajectory of the center of mass</h2>
<div class="sectionbody">
<div class="paragraph"><p>Using the reference zmp trajectory implemented in Tutorial 3.3,
implement a class <code>ComRef</code> that computes the reference trajectory of
the center of mass by optimal control.</p></div>
<div class="paragraph"><p>To write the underlying optimization problem, you can use a factor graph.
A simple implementation is available in <a href="factor_graph.html">(<strong>see the source code</strong>)</a>. An example of use is the following. Try to guess the solution before executing it.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.6
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>f <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">FactorGraph</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">,</span><span style="color: #993399">5</span><span style="color: #990000">)</span>   <span style="font-style: italic"><span style="color: #9A1900"># Define a factor of 5 variables of dimension 1</span></span>

M <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">eye</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">)</span>             <span style="font-style: italic"><span style="color: #9A1900"># M is simply 1 written as a 1x1 matrix.</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">for</span></span> i <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> <span style="font-weight: bold"><span style="color: #000000">range</span></span><span style="color: #990000">(</span><span style="color: #993399">4</span><span style="color: #990000">):</span>
    f<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addFactorConstraint</span></span><span style="color: #990000">(</span> <span style="color: #990000">[</span> <span style="font-weight: bold"><span style="color: #000000">Factor</span></span><span style="color: #990000">(</span> i<span style="color: #990000">,</span>M <span style="color: #990000">),</span> <span style="font-weight: bold"><span style="color: #000000">Factor</span></span><span style="color: #990000">(</span> i<span style="color: #990000">+</span><span style="color: #993399">1</span><span style="color: #990000">,-</span>M <span style="color: #990000">)</span> <span style="color: #990000">],</span> <span style="font-weight: bold"><span style="color: #000000">zero</span></span><span style="color: #990000">(</span><span style="color: #993399">1</span><span style="color: #990000">)</span> <span style="color: #990000">)</span>

f<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addFactor</span></span><span style="color: #990000">(</span> <span style="color: #990000">[</span> <span style="font-weight: bold"><span style="color: #000000">Factor</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">,</span>M<span style="color: #990000">)</span> <span style="color: #990000">],</span> M<span style="color: #990000">*</span><span style="color: #993399">10</span> <span style="color: #990000">)</span>
f<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">addFactor</span></span><span style="color: #990000">(</span> <span style="color: #990000">[</span> <span style="font-weight: bold"><span style="color: #000000">Factor</span></span><span style="color: #990000">(</span><span style="color: #993399">4</span><span style="color: #990000">,</span>M<span style="color: #990000">)</span> <span style="color: #990000">],</span> M<span style="color: #990000">*</span><span style="color: #993399">20</span> <span style="color: #990000">)</span>

x <span style="color: #990000">=</span> f<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">solve</span></span><span style="color: #990000">()</span></tt></pre></div></div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_3_4_reference_trajectories_of_the_feet">Tutorial 3.4: reference trajectories of the feet</h2>
<div class="sectionbody">
<div class="paragraph"><p>Using the same method as in Tutorial 3.2, implement two classes <code>RightAnkleRef</code>
and <code>LeftAnkleRef</code> that return reference positions of the ankles as homogeneous
matrices. Unlike zmp reference, trajectories of the feet should be continuously differentiable.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial_3_5_generate_walk_motion">Tutorial 3.5: generate walk motion</h2>
<div class="sectionbody">
<div class="paragraph"><p>Use the classes defined in the previous sections to generate a walk motion using
the inverse kinematics solver of Tutorial 2.</p></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2017-01-04 21:36:47 CET
</div>
</div>
</body>
</html>
